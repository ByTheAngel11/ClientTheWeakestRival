<UserControl x:Class="WPFTheWeakestRival.Controls.AvatarControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Name="root"
             Width="200"
             Height="260"
             SnapsToDevicePixels="True"
             UseLayoutRounding="True">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="B2V" />
    </UserControl.Resources>

    <!-- Escalado general -->
    <Viewbox Stretch="Uniform">
        <Grid Width="160"
              Height="220"
              RenderOptions.BitmapScalingMode="HighQuality">
            <Grid.Effect>
                <DropShadowEffect BlurRadius="6"
                                  ShadowDepth="0"
                                  Opacity="0.25" />
            </Grid.Effect>

            <!-- ===== Cabeza (más grande tipo Mii) ===== -->
            <Grid Width="100"
                  Height="115"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Top"
                  Margin="0,-4,0,0"
                  Panel.ZIndex="3">

                <!-- Contorno + piel -->
                <Ellipse Stroke="#4A3B2E"
                         StrokeThickness="3"
                         Fill="{Binding SkinBrush, ElementName=root}" />

                <!-- Brillo suave -->
                <Ellipse Margin="10,8,26,30"
                         IsHitTestVisible="False"
                         Opacity="0.35">
                    <Ellipse.Fill>
                        <RadialGradientBrush GradientOrigin="0.25,0.2"
                                             Center="0.3,0.25"
                                             RadiusX="0.7"
                                             RadiusY="0.7">
                            <GradientStop Color="#FFFFFFFF" Offset="0" />
                            <GradientStop Color="#00FFFFFF" Offset="1" />
                        </RadialGradientBrush>
                    </Ellipse.Fill>
                </Ellipse>

                <!-- Foto como rostro -->
                <Grid Visibility="{Binding FaceUsesPhoto,
                                           ElementName=root,
                                           Converter={StaticResource B2V}}">
                    <Ellipse Fill="{Binding FacePhotoBrush, ElementName=root}" />
                </Grid>

                <!-- Ojos/boca (si NO hay foto) -->
                <Canvas>
                    <Canvas.Style>
                        <Style TargetType="Canvas">
                            <Setter Property="Visibility" Value="Visible" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding FaceUsesPhoto, ElementName=root}"
                                             Value="True">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Canvas.Style>

                    <!-- OJOS tipo Mii (ligeramente ovalados) -->
                    <Ellipse x:Name="EyeLeftNeutral"
                             Width="9"
                             Height="11"
                             Fill="#262626"
                             Canvas.Left="26"
                             Canvas.Top="52" />
                    <Ellipse x:Name="EyeRightNeutral"
                             Width="9"
                             Height="11"
                             Fill="#262626"
                             Canvas.Right="26"
                             Canvas.Top="52" />

                    <!-- ojos (happy) -->
                    <Ellipse x:Name="EyeLeftHappy"
                             Width="12"
                             Height="6"
                             Fill="#262626"
                             Canvas.Left="22"
                             Canvas.Top="56"
                             Opacity="0" />
                    <Ellipse x:Name="EyeRightHappy"
                             Width="12"
                             Height="6"
                             Fill="#262626"
                             Canvas.Right="22"
                             Canvas.Top="56"
                             Opacity="0" />

                    <!-- Boca más corta, tipo línea recta -->
                    <Rectangle x:Name="MouthNeutral"
                               Width="22"
                               Height="3"
                               RadiusX="1.5"
                               RadiusY="1.5"
                               Fill="#262626"
                               Canvas.Left="39"
                               Canvas.Top="75" />
                    <Path x:Name="MouthHappy"
                          Stroke="#262626"
                          StrokeThickness="3"
                          Opacity="0"
                          Data="M 36,74 C 45,82 59,82 68,74" />
                    <Path x:Name="MouthAngry"
                          Stroke="#262626"
                          StrokeThickness="3"
                          Opacity="0"
                          Data="M 38,79 L 64,73" />
                </Canvas>

                <!-- Cabello estilo Mii (colocado después de la cara para renderizar por delante) -->
                <Path Stretch="Fill"
                      Margin="0,-12,0,69"
                      Fill="#5A4634"
                      Stroke="#3A2C22"
                      StrokeThickness="3"
                      Panel.ZIndex="4"
                      Data="M 8,40 C 10,10 90,10 92,40 L 92,50 C 80,44 70,50 60,44 50,50 40,44 30,50 20,44 14,50 8,50 Z" />
            </Grid>

            <!-- ===== Gorro (opcional, se mantiene pero por defecto oculto) ===== -->
            <Grid Width="100"
                  Height="46"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Top"
                  Visibility="{Binding HatVisible,
                                       ElementName=root,
                                       Converter={StaticResource B2V}}"
                  Panel.ZIndex="6">
                <Grid x:Name="HatBeanie" Opacity="0">
                    <Path Stroke="#2B2B2B"
                          StrokeThickness="3"
                          Fill="{Binding HatBrush, ElementName=root}"
                          Data="M 8,40 C 10,14 90,14 92,40 Z" />
                    <Rectangle Width="86"
                               Height="16"
                               RadiusX="8"
                               RadiusY="8"
                               Fill="{Binding HatRimBrush, ElementName=root}"
                               Margin="7,28,7,0"
                               VerticalAlignment="Top" />
                </Grid>

                <Grid x:Name="HatCap" Opacity="0">
                    <Path Stroke="#2B2B2B"
                          StrokeThickness="3"
                          Fill="{Binding HatBrush, ElementName=root}"
                          Data="M 10,38 C 14,12 86,12 90,38 Z" />
                    <Path Stroke="#2B2B2B"
                          StrokeThickness="3"
                          Fill="{Binding HatRimBrush, ElementName=root}"
                          Data="M 20,38 C 48,50 82,44 96,42" />
                </Grid>

                <Grid x:Name="HatTop" Opacity="0">
                    <Rectangle Width="68"
                               Height="30"
                               Fill="{Binding HatBrush, ElementName=root}"
                               Stroke="#2B2B2B"
                               StrokeThickness="3"
                               Margin="0,-6,0,0"
                               HorizontalAlignment="Center" />
                    <Rectangle Width="100"
                               Height="14"
                               Fill="{Binding HatRimBrush, ElementName=root}"
                               Stroke="#2B2B2B"
                               StrokeThickness="3"
                               VerticalAlignment="Top" Margin="0,41,0,0" />
                </Grid>
            </Grid>

            <!-- ===== Brazos + manos (más naturales, unidos al torso) ===== -->
            <Grid Width="140"
                  Height="56"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Center"
                  Margin="0,28,0,56"
                  Panel.ZIndex="2">

                <!-- Brazo izquierdo: un brazo delgado que parte del torso -->
                <Grid HorizontalAlignment="Left" VerticalAlignment="Center" Width="70" Height="28">
                    <Border Width="60" Height="18" CornerRadius="9"
                            Background="{Binding TorsoBrush, ElementName=root}"
                            BorderBrush="#2B2B2B" BorderThickness="3"
                            HorizontalAlignment="Left" VerticalAlignment="Center" Margin="8,0,0,0">
                        <Border.RenderTransform>
                            <!-- Left arm resting at 300° -->
                            <RotateTransform Angle="300" CenterX="30" CenterY="9" />
                        </Border.RenderTransform>
                    </Border>
                    <!-- Mano izquierda pegada al extremo del brazo -->
                    <Ellipse Width="18" Height="18" Fill="{Binding SkinBrush, ElementName=root}"
                             Stroke="#4A3B2E" StrokeThickness="3"
                             HorizontalAlignment="Left" VerticalAlignment="Center" Margin="10,0,10,-55" />
                </Grid>

                <!-- Brazo derecho -->
                <Grid HorizontalAlignment="Right" VerticalAlignment="Center" Width="70" Height="28">
                    <Border Width="60" Height="18" CornerRadius="9"
                            Background="{Binding TorsoBrush, ElementName=root}"
                            BorderBrush="#2B2B2B" BorderThickness="3"
                            HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,8,0">
                        <Border.RenderTransform>
                            <!-- Right arm resting at 240° -->
                            <RotateTransform Angle="240" CenterX="30" CenterY="9" />
                        </Border.RenderTransform>
                    </Border>
                    <!-- Mano derecha pegada al extremo del brazo -->
                    <Ellipse Width="18" Height="18" Fill="{Binding SkinBrush, ElementName=root}"
                             Stroke="#4A3B2E" StrokeThickness="3"
                             HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,10,-55" />
                </Grid>
            </Grid>

            <!-- ===== Torso (más delgado y alto, como Mii) ===== -->
            <Grid Width="65"
                  Height="100"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Center"
                  Margin="0,24,0,32"
                  Panel.ZIndex="1">
                <Border CornerRadius="22"
                        Background="{Binding TorsoBrush, ElementName=root}"
                        BorderBrush="#2B2B2B"
                        BorderThickness="3" />
                <Rectangle Margin="10,8,32,32"
                           Opacity="0.22">
                    <Rectangle.Fill>
                        <LinearGradientBrush StartPoint="0,0"
                                             EndPoint="1,1">
                            <GradientStop Color="#FFFFFFFF" Offset="0" />
                            <GradientStop Color="#00FFFFFF" Offset="1" />
                        </LinearGradientBrush>
                    </Rectangle.Fill>
                </Rectangle>
            </Grid>

            <!-- ===== Piernas separadas + zapatos (pies ahora pegados a las piernas) ===== -->
            <Grid Width="80"
                  Height="95"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Bottom"
                  Margin="0,0,0,4"
                  Panel.ZIndex="0">

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Pierna izquierda con zapato embebido -->
                <Grid Grid.Column="0" HorizontalAlignment="Center" VerticalAlignment="Top">
                    <Border Width="26" Height="70" CornerRadius="12"
                            Background="{Binding PantsBrush, ElementName=root}"
                            BorderBrush="#2B2B2B" BorderThickness="3"
                            HorizontalAlignment="Center" VerticalAlignment="Top" />
                    <!-- Zapato ahora pegado al fondo de la pierna -->
                    <Ellipse Width="26" Height="16" Fill="#262626"
                             HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,56,0,0" />
                </Grid>

                <!-- Pierna derecha con zapato embebido -->
                <Grid Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Top">
                    <Border Width="26" Height="70" CornerRadius="12"
                            Background="{Binding PantsBrush, ElementName=root}"
                            BorderBrush="#2B2B2B" BorderThickness="3"
                            HorizontalAlignment="Center" VerticalAlignment="Top" />
                    <Ellipse Width="26" Height="16" Fill="#262626"
                             HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,56,0,0" />
                </Grid>
            </Grid>
        </Grid>
    </Viewbox>
</UserControl>
